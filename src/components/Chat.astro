---
// Chat: AI assistant interface
// Inline chat section - connects to self-hosted Mistral
---

<section class="py-24 container-wide">
  <div class="mb-12 reveal">
    <h2 class="text-3xl font-semibold mb-4">Chat with <span class="text-accent">Talking Rock</span></h2>
    <p class="text-text-secondary max-w-2xl">
      Kellogg's AI assistant, running on his home server. Ask about his work, skills, or approach to data problems.
    </p>
  </div>

  <div
    id="chat-container"
    class="reveal max-w-3xl mx-auto bg-surface-raised border border-accent/20 rounded-2xl overflow-hidden shadow-[0_0_40px_rgba(6,182,212,0.08)]"
  >
    <!-- Messages area -->
    <div id="chat-messages" class="h-80 overflow-y-auto p-6 space-y-4">
      <div class="flex gap-3">
        <div class="w-8 h-8 rounded-full bg-gradient-to-br from-accent to-accent-dim flex items-center justify-center flex-shrink-0 shadow-[0_0_12px_rgba(6,182,212,0.3)]">
          <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
          </svg>
        </div>
        <div class="text-sm text-text-secondary bg-accent/5 border border-accent/10 rounded-lg p-3 max-w-[80%]">
          <p>Hi! I'm Talking Rock, Kellogg's AI assistant running on his home server. Ask me about his work, skills, or approach to data problems.</p>
        </div>
      </div>
    </div>

    <!-- Input area -->
    <div class="p-4 border-t border-accent/10 bg-surface-overlay">
      <div class="flex gap-3">
        <input
          type="text"
          id="chat-input"
          placeholder="Type a message..."
          class="flex-grow px-4 py-3 bg-surface border border-border rounded-xl text-sm text-text-primary placeholder-text-muted focus:outline-none focus:border-accent focus:shadow-[0_0_12px_rgba(6,182,212,0.15)] transition-all"
        />
        <button
          id="chat-send"
          class="px-5 py-3 bg-gradient-to-r from-accent-dim to-accent hover:from-accent hover:to-accent-hover rounded-xl transition-all flex items-center gap-2 shadow-[0_0_20px_rgba(6,182,212,0.2)] hover:shadow-[0_0_25px_rgba(6,182,212,0.35)]"
          aria-label="Send message"
        >
          <span class="text-sm font-medium text-white hidden sm:inline">Send</span>
          <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
          </svg>
        </button>
      </div>
    </div>
  </div>
</section>

<script>
  const input = document.getElementById('chat-input');
  const send = document.getElementById('chat-send');
  const messages = document.getElementById('chat-messages');

  const addMessage = (text: string, isUser: boolean) => {
    const wrapper = document.createElement('div');
    wrapper.className = 'flex gap-3' + (isUser ? ' flex-row-reverse' : '');

    const avatar = document.createElement('div');
    avatar.className = isUser
      ? 'w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 bg-surface-overlay border border-border'
      : 'w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 bg-gradient-to-br from-accent to-accent-dim shadow-[0_0_12px_rgba(6,182,212,0.3)]';
    avatar.innerHTML = isUser
      ? `<svg class="w-4 h-4 text-text-secondary" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg>`
      : `<svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" /></svg>`;

    const bubble = document.createElement('div');
    bubble.className = isUser
      ? 'text-sm rounded-lg p-3 max-w-[80%] bg-surface-overlay border border-border text-text-primary'
      : 'text-sm rounded-lg p-3 max-w-[80%] bg-accent/5 border border-accent/10 text-text-secondary';
    bubble.textContent = text;

    wrapper.appendChild(avatar);
    wrapper.appendChild(bubble);
    messages?.appendChild(wrapper);
    messages?.scrollTo({ top: messages.scrollHeight, behavior: 'smooth' });
  };

  const sendMessage = async () => {
    const text = (input as HTMLInputElement)?.value.trim();
    if (!text) return;

    addMessage(text, true);
    (input as HTMLInputElement).value = '';

    // Placeholder response - TODO: Connect to self-hosted Mistral
    setTimeout(() => {
      addMessage('Talking Rock backend coming soon. This will connect to Kellogg\'s self-hosted AI.', false);
    }, 500);
  };

  send?.addEventListener('click', sendMessage);
  input?.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') sendMessage();
  });
</script>
